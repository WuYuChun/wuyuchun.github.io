<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
    <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <title>定义自己的Debug信息 &#8211; 西电托儿所</title>
    <meta name="description" content="       Contents    ">
    <meta name="keywords" content="windows">
    <link rel="canonical" href="/%E5%AE%9A%E4%B9%89%E8%87%AA%E5%B7%B1%E7%9A%84Debug%E4%BF%A1%E6%81%AF/">
        <!-- Twitter Cards -->
    <meta name="twitter:title" content="定义自己的Debug信息">
    <meta name="twitter:description" content="       Contents    ">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content="/assets/img/Logo.png">
    <!-- Open Graph -->
    <meta property="og:locale" content="utf-8">
    <meta property="og:type" content="article">
    <meta property="og:title" content="定义自己的Debug信息">
    <meta property="og:description" content="       Contents    ">
    <meta property="og:url" content="/%E5%AE%9A%E4%B9%89%E8%87%AA%E5%B7%B1%E7%9A%84Debug%E4%BF%A1%E6%81%AF/">
    <meta property="og:site_name" content="西电托儿所">
    <meta property="og:image" content="/assets/img/Logo.png">

    
    
    <!-- Handheld -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Favicons -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/assets/img/favicon/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/img/favicon/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/img/favicon/apple-touch-icon-144x144.png">
    <link rel="icon" type="image/png" href="/assets/img/favicon/favicon.png">
    <link rel="shortcut icon" href="/assets/img/favicon/favicon.ico">
    <!-- Feed -->
    <link rel="alternate" type="application/rss+xml" title="西电托儿所" href="/feed.xml" />
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css">
</head>


<body>
        <nav class="nav">
        <ul class="list">
            
				    
				    <li class="item"><a class="link" href="/" >Home</a></li>
				
				    
				    <li class="item"><a class="link" href="/blog/" >Blog</a></li>
				
				    
				    <li class="item"><a class="link" href="/projects/" >Projects</a></li>
				
				    
				    <li class="item"><a class="link" href="/about/" >About</a></li>
				
        </ul>
    </nav>

    <div class="wrapper">
        <div class="title">
            <h1>定义自己的Debug信息</h1>
            <h4>02 Jul 2015</h4>
        </div>
        <div class="article">
            <section id="table-of-contents" class="toc">
  <header>
    <h3><i class="fa fa-book"></i> Contents</h3>
  </header>
<div id="drawer">
<ul id="markdown-toc">
  <li><a href="#debug" id="markdown-toc-debug">定义自己的Debug函数</a>    <ul>
      <li><a href="#section" id="markdown-toc-section">追踪函数</a></li>
      <li><a href="#bug" id="markdown-toc-bug">Bug信息输出</a></li>
    </ul>
  </li>
  <li><a href="#section-1" id="markdown-toc-section-1">总结</a></li>
</ul>

  </div>
</section>
<!-- /#table-of-contents -->

<p>[21:32]</p>

<h2 id="debug">定义自己的Debug函数</h2>

<p>在编写程序，希望自己的调试信息，并依此跟踪程序出现的问题。因此需要定义自己的Debug函数，以便自己更好的分析问题的所在。下面是自己用的Debug函数。</p>

<h3 id="section">追踪函数</h3>

<p>追踪函数主要用于确定是否进入函数内。用于定位是否已经进入到函数中。先码上代码。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>define DEFUBFILE "D:\\Debug.log"
#define DEBUGTRACE(X) { \
	QFile file(DEFUBFILE);\
	file.open(QIODevice::ReadWrite | QIODevice::Append | 	QIODevice::Text);\
	QTextStream out(&amp;file);\
	QString logTime = QDateTime::currentDateTime().toString("[yyyy-dd-MM hh:mm:ss.zzz]");\
	QString result = QString("%1 :{ %2:%3---%4}").arg(X).arg(__FILE__).arg(__LINE__).arg(__FUNCTION__);\
	out &lt;&lt; logTime &lt;&lt;" "&lt;&lt;  result &lt;&lt; endl; \
	file.close();\
}

</code></pre>
</div>
<p>注意这里主要用Qt写的，因此用的话需要包含Qt的东西，当然也很容易修改成C++。这样在自己的函数中就可以这样写，如下代码
<code class="highlighter-rouge">
int func()
{
	DEBUGTRACE("ENTER");
    //do something
    DEBUGTRACE("LEAVE");
}
</code>
这样当判断是否调用某个函数的时候，就可以打开log,然后定位了。</p>

<h3 id="bug">Bug信息输出</h3>
<p>有了跟踪函数以后，需要把log信息打印出来，以各种形式打印出来，因此也需要定义自己的log信息输出函数。上码：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>#define LOGWRITER(format,...) {\
	char logBuffer[BUFFER_LENGTH] = {0};\
	sprintf(logBuffer,format,## __VA_ARGS__);\
	QString logTime = QDateTime::currentDateTime().toString("[yyyy-dd-MM hh:mm:ss.zzz]");\
	QString result = QString("{ %1:%2---%3 }").arg(__FILE__).arg(__LINE__).arg(__FUNCTION__);\
	QFile file(DEFUBFILE);\
	file.open(QIODevice::ReadWrite | QIODevice::Append | QIODevice::Text);\
	QTextStream out(&amp;file);\
	out&lt;&lt;logTime&lt;&lt;" "&lt;&lt;logBuffer&lt;&lt;" :"&lt;&lt;result&lt;&lt;endl;\
	file.close();\
}
</code></pre>
</div>
<p>这上面的代码使用了可变长参数的用法。因此可以像printf函数一样使用了。
注意上面也是使用了Qt的一些东西，当然也非常容易的转化为C++代码。</p>

<h2 id="section-1">总结</h2>
<p>也许程序中用了日记系统，例如log4Cpp等这样的日记系统，但是有时非常大，而我们仅仅需要一种比较简单的方式记录一些调试信息而已，不会去考虑多线程之类的各种情况。</p>


        </div>
    </div>
        <div class="footer">
        西电托儿所 © 2016 <a href="/feed.xml" target="_blank"><i class="fa fa-fw fa-feed"></i></a>
    </div>

    <script src="/assets/js/jquery-1.12.2.min.js"></script>
<script src="/assets/js/jquery.goup.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    $.goup({
        trigger: 500,
        bottomOffset: 10,
        locationOffset: 20,
        containerRadius: 0,
        containerColor: '#fff',
        arrowColor: '#000',
        goupSpeed: 'normal'
    });
});
</script>


</body>
</html>
