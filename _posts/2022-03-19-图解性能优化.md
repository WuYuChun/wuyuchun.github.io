# 图解性能优化



## 性能的基础知识

- 算法性能
- 响应：应答的快慢
- 吞吐：处理数量的多少
- 考虑性能时，思考系统是偏重于响应，偏重于吞吐
- 锁：
  - 锁是在并行处理的情况下所必须的机制
  - 锁也会影响性能，从锁的机制来考虑，怎样才能解决这个问题？----》让正受保护的处理尽快完成



## 性能分析的基础

- 性能必须是可以测量的
- 性能分析原则（分段查找原则）
  - 时间分段
  - 空间分段
- 性能信息的种类
  - 概要形式：不适合用来调查问题的原因
    - sar：主要知道CPU的使用率和空闲情况、读写I/O的量，内存的概括，不能知道的事情：各个进程的情况、瞬间的性能问题
    - vmstat：等待执行的平均进程数、由于某些原因而被迫等待的平均进程数、CPU使用率、对Swap空间的I/O，不能知道的事情：各个进程的情况、瞬间的性能问题
    - iostat
    - 编程语言使用相对应的Profile
  - 事件记录形式
    - strace
    - 编程语言C++使用LOG4这样的日志系统
  - 快照形式：适合用来调查问题的原因
    - ps：由于这个命令负荷较大，因此不能再短时间内重复执行
    - top：短时间内重复
    - netstat
    - pstack



## 实际系统的性能分析

- 等待队列理论
  - 意识到基础不稳
  - 服务时间
  - 响应时间=访问等待时间+服务时间
  - 即使平均使用率没有达到100%也会出现等待时间，因为请求的到达时间不是平均分布的
  - 随着使用率接近100%，等待时间会呈现指数级别地增加
- os的命令
- 存储性能分析的思路
- 性能分析陷阱
  - 关注受害者------重点是调查“谁引起的”
  - 意识到基础不稳



## 性能调优

- 调优的原则
- 调优的技巧



## 性能测试

- 常见的失败情况
  - 不能再期限内完成
  - 性能很差，解决不了性能问题
  - 由于没有考虑到环境差异而导致的问题
  - 压力场景设计不完备
  - 没有考虑到缓冲、缓存的使用
    - 性能测试效果很好，但是在生产环境中性能很差，需要注意系统的缓存、缓冲的使用状态
- 性能测试种类
  - 临界测试
  - 回退性能测试
  - 基础设施性能测试



## 虚拟化环境下的性能

- 虚拟化的种类
  - Host OS：在宿主机上安装虚拟化软件
  - 宿主机：在硬件BIOS上直接启动虚拟化软件
    - 完全虚拟化
    - 半虚拟化
- 更改命令的处理、将逻辑CPU分配给VM的处理是虚拟环境下特有的会影响CPU性能的因素
- 虚拟环境下内存性能问题在于虚拟化的额外开销和内存的过载使用



## 云计算环境下的性能



















