I"É<p>listi</p>

<p>[11:59 PM]</p>

<h1 id="å‰è¨€">å‰è¨€</h1>
<p>å¯¹ç®—æ³•è¿›è¡Œæ”¹è¿›ä»¥æ±‚è·å¾—æœ€ä½³çš„æ€§èƒ½é€šå¸¸æœ‰ä¸¤ç§ç­–ç•¥ï¼šä¼˜åŒ–ç°æœ‰çš„ç®—æ³•ï¼Œæˆ–è€…å¼€å‘æ–°çš„ç®—æ³•ã€‚</p>

<p>ä¼˜åŒ–ç®—æ³•çš„æ ‡å‡†æŠ€æœ¯ï¼š
1ã€ä½¿I/Oå‡åˆ°æœ€å°‘ï¼Œå‡å°‘å‡½æ•°è°ƒç”¨çš„æ¬¡æ•°ï¼Œé™åˆ¶è®¡ç®—å¯†é›†å‹æ“ä½œï¼ˆæµ®ç‚¹æ•°è¿ç®—å’Œé™¤æ³•è¿ç®—ï¼‰ï¼›
2ã€ç¡®å®šæ‰§è¡Œå¾—æœ€é¢‘ç¹çš„ç®—æ³•å…ƒç´ ï¼Œæ¯”å¦‚å†’æ³¡æ’åºçš„æ¯”è¾ƒå’Œäº¤æ¢ï¼›
3ã€æ£€æŸ¥å¯èƒ½ç”±äºç–å¿½å¯¼è‡´è€Œå¯¼è‡´ç‰¹åˆ«ç¼“æ…¢çš„çš„å®ç°ã€‚è¿™å¾€å¾€ä¸æŸ¥æ‰¾æœ€åæƒ…å†µç›¸ä¼¼ã€‚</p>

<p>I/Oé€šå¸¸æ˜¯å‘ç”Ÿåœ¨æ¯«ç§’(ms)çº§çš„æ—¶é—´èŒƒå›´å†…ï¼Œè€ŒCPUçš„æ´»åŠ¨ä¸€èˆ¬å‘ç”Ÿåœ¨äºšå¾®ç§’çº§çš„èŒƒå›´å†…ã€‚å› æ­¤å¯¹äºç®—æ³•è€Œè¨€ï¼Œä»»ä½•I/Oçš„ä»£ä»·éƒ½éå¸¸é«˜æ˜‚ã€‚
å¦‚æœä¸èƒ½æ¶ˆé™¤I/Oæœ¬èº«ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç¼“å†²åŒºæ¥å‡å°å®ƒçš„å½±å“ã€‚</p>

<h1 id="ä»£ç ">ä»£ç </h1>
<p>ä¸‹é¢çš„ä¸€ä¸ªç®—æ³•ï¼Œå°±æ˜¯ç”¨æ¥æµ‹è¯•ä»è¾“å…¥æ–‡ä»¶æµinfileå‘è¾“å‡ºæ–‡ä»¶æµoutfileä¼ è¾“æ—¶ï¼Œå¤šå°‘å¤§å°çš„ç¼“å†²åŒºbufæœ€åˆé€‚(æ—¢å¯ä»¥é€Ÿåº¦è¾¾åˆ°æœ€å¿«ï¼Œä¹Ÿä¸æµªè´¹å­˜å‚¨ç©ºé—´)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;limits.h&gt;
#include &lt;Windows.h&gt;

#undef CopyFile//å–æ¶ˆä»¥å‰å®šä¹‰çš„CopyFileï¼ˆä¸‹é¢æœ‰é‡å†™çš„CopyFile()ï¼‰  
#pragma comment(lib, "kernel32.lib")//yyw  

#define DEF_BUF 512  

long GetCPUTime() 
{
	static LARGE_INTEGER li = {0};  //é™æ€å˜é‡~~åˆå§‹åŒ–ä¸€æ¬¡
	LARGE_INTEGER linow = {0};

	if ( 0 == li.QuadPart)
	{
		QueryPerformanceFrequency(&amp;li);
	}
	QueryPerformanceCounter(&amp;linow);

	return linow.QuadPart*1000/li.QuadPart;
}

#define get_clock_ticks(x) \
	x = GetCPUTime()

long CopyFile( char *inFileName, char *outFileName,size_t insize,size_t outsize)
{
	int c;
	long starttime, donetime;
	FILE *infile = NULL, *outfile = NULL;

	if ( (infile = fopen(inFileName,"rb")) == NULL )
	{
		printf("Can't open %s\n",inFileName);
		exit(1);
	}

	if ( setvbuf(infile,NULL,_IOFBF,insize))
	{
		printf("counld't set infile buffer to %u bytes\n",insize);
		exit(1);
	}

	if ( (outfile = fopen(outFileName,"wb")) == NULL )
	{
		printf("can't open %s\n",outFileName);
		exit(1);
	}

	if ( setvbuf(outfile,NULL,_IOFBF,outsize) )
	{
		printf("counld't set outfile buffer to %u bytes\n",insize);
		exit(1);
	}

	get_clock_ticks(starttime);
	while( (c = fgetc(infile)) != EOF )
	{
		fputc(c,outfile);
	}
	get_clock_ticks(donetime);
	fclose(infile);
	fclose(outfile);
	return (donetime - starttime);
}







int main(int argc , char *argv[])
{
	size_t insize, outsize;
	int i;
	long total, average, lo, hi, elapsed;
	insize = outsize = DEF_BUF;

	if ( argc &lt;3 || argc &gt; 5 )
	{
		fprintf(stderr,"Usage infire!!!!!\n");
		return (EXIT_FAILURE);
	}

	if ( argc &gt; 3)
	{
		insize = (unsigned)atoi(argv[3]);
	}
	if ( argc &gt; 4 )
	{
		outsize = (unsigned)atoi(argv[4]);
	}

	total = hi = 0;
	lo = LONG_MAX;
	for ( i = 1; ; ++i)
	{
		elapsed = CopyFile(argv[1],argv[2],insize,outsize);

		if ( elapsed &gt; hi)
		{
			hi = elapsed;
		}

		if ( elapsed &lt; lo)
		{
			lo = elapsed;
		}

		total += elapsed;

		if ( total &gt; 500 || i &gt; 4)
		{
			break;
		}
	}

	average = total/i;

	FILE *result = NULL;
	result = fopen("result.txt","ab");
	if ( NULL == result )
	{
		exit(EXIT_FAILURE);
	}
	fprintf(result,"Average of %4ld ticks (%4ld - %4ld).Insize = %5u. Outsize = %5u.\n",
		average, lo, hi, insize, outsize );

	return ( EXIT_SUCCESS );  


}

</code></pre></div></div>

<h1 id="å…³é”®å‡½æ•°">å…³é”®å‡½æ•°</h1>
<p>##QueryPerformanceFrequency() - åŸºæœ¬ä»‹ç»
ç±»å‹ï¼šWin32API
åŸå‹ï¼šBOOL QueryPerformanceFrequency(LARGE_INTEGER *lpFrequency);
ä½œç”¨ï¼šè¿”å›ç¡¬ä»¶æ”¯æŒçš„é«˜ç²¾åº¦è®¡æ•°å™¨çš„é¢‘ç‡ã€‚
è¿”å›å€¼ï¼šéé›¶ï¼Œç¡¬ä»¶æ”¯æŒé«˜ç²¾åº¦è®¡æ•°å™¨ï¼›é›¶ï¼Œç¡¬ä»¶ä¸æ”¯æŒï¼Œè¯»å–å¤±è´¥ã€‚
##QueryPerformanceFrequency() - æŠ€æœ¯ç‰¹ç‚¹
ä¾›WIN9Xä½¿ç”¨çš„é«˜ç²¾åº¦å®šæ—¶å™¨ï¼šQueryPerformanceFrequency()å’ŒQueryPerformanceCounter()ï¼Œè¦æ±‚è®¡ç®—æœºä»ç¡¬ä»¶ä¸Šæ”¯æŒé«˜ç²¾åº¦å®šæ—¶å™¨ã€‚
å‡½æ•°çš„åŸå½¢æ˜¯ï¼š
ã€€ã€€BOOL QueryPerformanceFrequency(LARGE_INTEGER *lpFrequency);
ã€€ã€€BOOL QueryPerformanceCounter (LARGE_INTEGER *lpCount);
æ•°æ®ç±»å‹LARGEINTEGERæ—¢å¯ä»¥æ˜¯ä¸€ä¸ªä½œä¸º8å­—èŠ‚é•¿çš„æ•´æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä½œä¸ºä¸¤ä¸ª4å­—èŠ‚é•¿çš„æ•´æ•°çš„è”åˆç»“æ„ï¼Œå…¶å…·ä½“ç”¨æ³•æ ¹æ®ç¼–è¯‘å™¨æ˜¯å¦æ”¯æŒ64ä½è€Œå®šã€‚è¯¥ç±»å‹çš„å®šä¹‰å¦‚ä¸‹ï¼š
ã€€ã€€typeef union _ LARGE_INTEGER
ã€€ã€€{
ã€€ã€€ struct
ã€€ã€€ {
ã€€ã€€ DWORD LowPart;
ã€€ã€€ LONG HighPart;
ã€€ã€€ };
ã€€ã€€ LONGLONG QuadPart;
ã€€ã€€} LARGE_INTEGER;
åœ¨å®šæ—¶å‰åº”è¯¥å…ˆè°ƒç”¨QueryPerformanceFrequency()å‡½æ•°è·å¾—æœºå™¨å†…éƒ¨è®¡æ—¶å™¨çš„æ—¶é’Ÿé¢‘ç‡ã€‚æ¥ç€åœ¨éœ€è¦ä¸¥æ ¼è®¡æ—¶çš„äº‹ä»¶å‘ç”Ÿå‰å’Œå‘ç”Ÿä¹‹ååˆ†åˆ«è°ƒç”¨QueryPerformanceCounter()ï¼Œåˆ©ç”¨ä¸¤æ¬¡è·å¾—çš„è®¡æ•°ä¹‹å·®å’Œæ—¶é’Ÿé¢‘ç‡ï¼Œå°±å¯ä»¥è®¡ç®—å‡ºäº‹ä»¶ç»å†çš„ç²¾ç¡®æ—¶é—´ã€‚</p>

<h1 id="è¿è¡Œç»“æœ">è¿è¡Œç»“æœ</h1>
<p><img src="http://img.blog.csdn.net/20150419011658409" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" />
<img src="http://img.blog.csdn.net/20150418235554523" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°" /></p>

<p><strong>è¿è¡Œç»“æœçš„å›¾ä½¿ç”¨Pythonè§£ææ‰€è·å–çš„ç»“æœæ‰€ç”»ï¼</strong>
pythonä»£ç å¦‚ä¸‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import string
import matplotlib.pyplot as plt  
import numpy as np
import re

if __name__ == '__main__':   
    
     size = []
     time = []
     
     file = open(r'result.txt','r')
     lineList = file.readlines()
     for element in lineList:
         m = re.findall(r'(\w*[0-9]+)\w*', element)
         #print(m)
         time.append(m[0])
         size.append(m[3])
         
     #print(size)
     #print(time)
    
     plt.plot(size, time, 'b*')
     plt.plot(size, time, 'r')
   
     plt.ylim(0, 100)
     plt.xlim(0,2058)
     plt.title('Better Bufsize')
     plt.legend()
     plt.show()
</code></pre></div></div>

<h1 id="ç»“è®º">ç»“è®º</h1>
<p>å½“è®¾ç½®çš„ç¼“å†²åŒºå¤§å°ä¸º1024çš„æ—¶å€™ï¼Œå·²ç»æ˜¯æœ€å°‘ï¼ŒåŠæ—¶åé¢ä¸€ç›´åœ¨å¢åŠ ç¼“å†²åŒºçš„å¤§å°ï¼Œä¹Ÿä¸èƒ½ç»™æ€§èƒ½å¸¦æ¥æå‡çš„ã€‚</p>
:ET